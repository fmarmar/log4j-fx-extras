package me.fx.log4j.layout;

import static org.junit.Assert.assertEquals;

import org.junit.Before;
import org.junit.Test;

/**
 * 
 * @author fmarmar
 *
 */
public class MaskMessagePatternLayoutTest {
	
	
	private MaskMessagePatternLayout layout;
	
	
	@Before
	public void initTest() {
		layout = new MaskMessagePatternLayout();
	}
	
	@Test
	public void testMapMessageSimple() {
		
		String originalMsg, expectedMsg;
		
		layout.setMaskRegex("\"\"claveOperaciones\"\":\"\"([\\p{Graph}&&[^\"]]+)\"\"");
		
		assertEquals(null, layout.mapMessage(null));
		
		originalMsg = "C#0#2013-04-18 19:40:53.005#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#113b7449-abd9-4f36-8673-d2e9a660346d#0000001427#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/actualizacionFechaUltimoAcceso#\"[{\"\"usuarioLogado\"\":{\"\"codigoBanco\"\":\"\"0182\"\",\"\"codigoPais\"\":\"\"ES\"\",\"\"codigoUsuario\"\":\"\"012345619R\"\",\"\"metodoAcceso\"\":\"\"02\"\"}}]\"#";
		assertEquals(originalMsg, layout.mapMessage(originalMsg));
		
		originalMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"1234567\"\"},\"\"claveOperaciones\"\":null,\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		expectedMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"****\"\"},\"\"claveOperaciones\"\":null,\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		assertEquals(expectedMsg, layout.mapMessage(originalMsg));
		
		originalMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"1234567\"\"},\"\"claveOperaciones\"\":\"\"1234567\"\",\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		expectedMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"****\"\"},\"\"claveOperaciones\"\":\"\"****\"\",\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		assertEquals(expectedMsg, layout.mapMessage(originalMsg));
		
		layout.setMaskRegex("\"(#)");
		originalMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"1234567\"\"},\"\"claveOperaciones\"\":\"\"1234567\"\",\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		expectedMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"1234567\"\"},\"\"claveOperaciones\"\":\"\"1234567\"\",\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"****";
		assertEquals(expectedMsg, layout.mapMessage(originalMsg));
		
	}
	
	@Test
	public void testMapMessageCompound() {
		
		String originalMsg, expectedMsg;
		
		layout.setMaskRegex("\"\"claveOperaciones\"\":\"\"([\\p{Graph}&&[^\"]]+)\"\"|\"\"identificadorFiscal\"\":\"\"([\\p{Graph}&&[^\"]]+)\"\"");
		
		originalMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"1234567\"\"},\"\"claveOperaciones\"\":null,\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"012345619R\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		expectedMsg = "C#0#2013-04-18 19:41:48.256#kqof#9040AD6FCC528B82D9CC044B5C4E7ABF#94a19fba-eeb0-42e8-b5f3-9860259018dd#0000000224#012345619R#099813228#04#07#0019#ES#0182#POST#http://ai003.igrupobbva:6945/enps_mult_web_servicing_01/remoting/firmaOperacionesEstrategico#\"[{\"\"claveDeOperaciones\"\":{\"\"claveOperaciones\"\":\"\"****\"\"},\"\"claveOperaciones\"\":null,\"\"codigoCliente\"\":null,\"\"codigoEntidadFinanciera\"\":null,\"\"codigoLogon\"\":{\"\"codigo\"\":{\"\"codigo\"\":\"\"0019-012345619R\"\",\"\"codigoAlicacion\"\":\"\"0019\"\",\"\"identificadorFiscal\"\":\"\"****\"\"},\"\"codigoLogon\"\":\"\"0019-012345619R\"\"},\"\"contratoCliente\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"entidad\"\":\"\"0182\"\",\"\"pais\"\":\"\"ES\"\"},\"\"dtoEntradaOperacion\"\":{\"\"codigoCliente\"\":\"\"099813228\"\",\"\"contratoDestino\"\":null,\"\"contratoOrigen\"\":null,\"\"cuentaDestino\"\":{\"\"cuenta\"\":\"\"0201801486\"\",\"\"digitoControl\"\":\"\"65\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"cuentaOrigen\"\":{\"\"cuenta\"\":\"\"0201827882\"\",\"\"digitoControl\"\":\"\"64\"\",\"\"entidad\"\":\"\"0182\"\",\"\"oficina\"\":\"\"4000\"\"},\"\"importe\"\":{\"\"divisa\"\":{\"\"currencyCode\"\":\"\"EUR\"\",\"\"defaultFractionDigits\"\":2,\"\"symbol\"\":\"\"€\"\"},\"\"divisaCode\"\":\"\"EUR\"\",\"\"importe\"\":1.0},\"\"observaciones\"\":\"\"\"\"},\"\"identificadorAplicacion\"\":\"\"19\"\",\"\"identificadorOperativa\"\":\"\"0000000224\"\",\"\"identificadorSesion\"\":\"\"9040AD6FCC528B82D9CC044B5C4E7ABF\"\",\"\"idioma\"\":\"\"1\"\",\"\"tipoAccesoAlSistema\"\":\"\"NIF\"\",\"\"tipoFirmaSegura\"\":null,\"\"usuarioLogado\"\":null}]\"#";
		assertEquals(expectedMsg, layout.mapMessage(originalMsg));
	
	}
}